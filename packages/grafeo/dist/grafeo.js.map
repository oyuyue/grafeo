{"version":3,"sources":["webpack://grafeo/webpack/universalModuleDefinition","webpack://grafeo/./src/utils.ts","webpack://grafeo/./src/app/loading.ts","webpack://grafeo/./src/app/error.ts","webpack://grafeo/./src/app/AppInfo.ts","webpack://grafeo/./src/app/index.ts","webpack://grafeo/./src/constants.ts","webpack://grafeo/./src/event.ts","webpack://grafeo/./src/enable.ts","webpack://grafeo/./src/navigation.ts","webpack://grafeo/webpack/bootstrap","webpack://grafeo/webpack/startup","webpack://grafeo/webpack/runtime/define property getters","webpack://grafeo/webpack/runtime/hasOwnProperty shorthand","webpack://grafeo/webpack/runtime/make namespace object"],"names":["root","factory","exports","module","define","amd","a","i","self","isString","o","isFunction","noop","getElement","el","document","querySelector","centerElement","div","createElement","style","width","height","display","alignItems","justifyContent","requestIdleCallback","cb","setTimeout","errors","storeError","err","push","loading","opts","ele","innerHTML","color","appendChild","parentNode","removeChild","error","info","cursor","destroy","addEventListener","mount","AppInfo","loaded","mounting","mounted","load_","this","load","System","import","name","mountWhen","isRouteMatch","path","regex","lastIndex","inDynamic","regexStr","charIndex","length","char","endOfDynamic","appendToRegex","RegExp","index","commonStringSubPath","slice","replace","charAt","toDynamicPathValidatorRegex","_","p","test","urlToValidator","uiLoading","uiError","appEntry","entry","app","props","update","createApp","unloading","mountEl","loadingProps","destroyUIError","errorProps","undefined","appMap","Object","create","exportApp","fn","options","isRoot","res","ret","Array","isArray","assign","getApps","keys","map","x","getApp","getAppChanges","mounts","destroys","forEach","matched","location","isMounted","registerApp","prefetch","bind","unregisterApp","destroyApp","async","mountApp","updateApp","EVENT_ENABLE","EVENT_DISABLE","onceSupported","prefix","window","CustomEvent","e","event","params","bubbles","cancelable","detail","evt","createEvent","initCustomEvent","prototype","Event","defineProperty","listenerMap","Map","createListener","listener","on","l","set","once","tmp","off","get","removeEventListener","delete","emit","dispatchEvent","setEventPrefix","reqAniId","enabled","isEnabled","enable","disable","createPopStateEvent","state","PopStateEvent","initPopStateEvent","patchedUpdateState","updateState","urlBefore","href","result","apply","arguments","urlAfter","history","onReroute","cancelAnimationFrame","requestAnimationFrame","apps","origin","search","split","throwErrors","originPushState","pushState","originReplaceState","replaceState","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","d","definition","key","enumerable","obj","prop","hasOwnProperty","call","r","Symbol","toStringTag","value"],"mappings":"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","file":"grafeo.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(self, function() {\nreturn ","export function typeStr(o: any): string {\n  return Object.prototype.toString.call(o).slice(8, -1);\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function isObject(o: any): o is Object {\n  return typeStr(o) === 'Object';\n}\n\nexport function isString(o: any): o is string {\n  return typeof o === 'string';\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function isFunction(o: any): o is Function {\n  return typeof o === 'function';\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nexport function noop(): void {}\n\nexport function merge<T extends Record<string, any>>(\n  dest: Record<string, any>, \n  source: Record<string, any>,\n  paths?: string[],\n  parentPath?: string\n): T {\n  dest = dest || {};\n  let item;\n  Object.keys(source).forEach(k => {\n    item = source[k];\n    const p = parentPath ? parentPath + '.' + k : k;\n    if (isObject(item)) {\n      dest[k] = merge(dest[k], item, paths, p);\n    } else {\n      if (paths) paths.push(p);\n      dest[k] = source[k];\n    }\n  });\n  return dest as T;\n}\n\nexport function getElement(el: string | Element): Element {\n  if (isString(el)) return document.querySelector(el) as HTMLElement;\n  return el;\n}\n\nexport function centerElement(): HTMLElement {\n  const div = document.createElement('div');\n  div.style.width = '100%';\n  div.style.height = '100%';\n  div.style.display = 'flex';\n  div.style.alignItems = 'center';\n  div.style.justifyContent = 'center';\n  return div;\n}\n\nexport const requestIdleCallback = (self as any).requestIdleCallback || function (cb: () => any) { return setTimeout(cb, 1); };\n\nlet errors: Error[] = [];\nexport function storeError(err: Error) {\n  errors.push(err);\n}\n\nexport function throwErrors() {\n  if (!errors.length) return;\n  const tmp = errors;\n  errors = [];\n  throw tmp;\n}\n","import { noop, getElement, centerElement } from '../utils';\n\nexport default function loading(el: string | Element, opts: any = {}): () => void {\n  const ele = getElement(opts.el || el);\n  if (!ele) return noop;\n  const loading = centerElement();\n  loading.innerHTML = `<svg fill=\"${opts.color || '#03A9F4'}\" viewBox=\"0 0 52 20\" width=\"52\"><circle cx=\"6\" cy=\"10\" r=\"6\"><animate attributeName=\"opacity\" dur=\"1s\" values=\"0;1;0\" repeatCount=\"indefinite\" begin=\".1\"/></circle><circle cx=\"26\" cy=\"10\" r=\"6\"><animate attributeName=\"opacity\" dur=\"1s\" values=\"0;1;0\" repeatCount=\"indefinite\" begin=\".2\"/></circle><circle cx=\"46\" cy=\"10\" r=\"6\"><animate attributeName=\"opacity\" dur=\"1s\" values=\"0;1;0\" repeatCount=\"indefinite\" begin=\".3\"/></circle></svg>`;\n  ele.appendChild(loading);\n  return function() {\n    if (loading.parentNode) {\n      loading.parentNode.removeChild(loading);\n    }\n  };\n}\n","import { centerElement, getElement, noop } from '../utils';\nimport AppInfo from './AppInfo';\n\nexport default function error(el: string | Element, opts: any = {}, info: AppInfo) {\n  const ele = getElement(opts.el || el);\n  if (!ele) return noop;\n  const error = centerElement();\n  error.style.cursor = 'pointer';\n  error.innerHTML = `<svg viewBox=\"0 0 24 24\" width=\"50\"><path fill=\"${opts.color || '#D32F2F'}\" d=\"M13 13h-2V7h2m0 10h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2z\"/></svg>`;\n  const destroy = function() {\n    if (error.parentNode) {\n      error.parentNode.removeChild(error);\n    }\n  };\n\n  error.addEventListener('click', function() {\n    destroy();\n    info.mount(el);\n  });\n\n  ele.appendChild(error);\n\n  return destroy;\n}\n","import { RegisterAppOptions } from '.';\nimport { noop, isFunction, isString } from '../utils';\nimport { App, AppEntry } from './types';\nimport loading from './loading';\nimport error from './error';\n\nexport default class AppInfo {\n  private loaded = false;\n  private mounting = false;\n  private mounted = false;\n  private load_: () => Promise<AppEntry> = noop as any;\n  private appEntry!: AppEntry;\n  private app!: Required<App>;\n  \n  private opts: RegisterAppOptions;\n  private uiLoading: ((el: string | Element, opts: any) => () => void) | undefined;\n  private uiError: ((el: string | Element, opts: any, info: AppInfo) => () => void) | undefined;\n  private destroyUIError: (()  => void) | undefined;\n  \n  isRouteMatch?: (loc: Location, path: string) => boolean;\n  \n  constructor(opts: RegisterAppOptions) { \n    this.opts = opts;\n\n    if (isFunction(opts.load)) {\n      this.load_ = opts.load;\n    } else {\n      this.load_ = () => System.import(opts.load || opts.name);\n    }\n\n    if (isString(opts.mountWhen)) {\n      this.isRouteMatch = urlToValidator(opts.mountWhen);\n    } else if (isFunction(opts.mountWhen)) {\n      this.isRouteMatch = opts.mountWhen;\n    }\n\n    if (isFunction(opts.loading)) {\n      this.uiLoading = opts.loading;\n    } else if (opts.loading !== false) {\n      this.uiLoading = loading;\n    }\n\n    if (isFunction(opts.error)) {\n      this.uiError = opts.error;\n    } else if (opts.error !== false) {\n      this.uiError = error;\n    }\n  }\n\n  async load(): Promise<void> {\n    if (this.loaded && this.appEntry) return;\n    const entry = await this.load_();\n    this.loaded = true;\n    this.appEntry = entry;\n  }\n\n  async createApp(opts?: any): Promise<void> {\n    await this.load();\n    if (this.appEntry) {\n      this.app = this.appEntry(opts || this.opts.props);\n    }\n  }\n\n  async update(opts?: any): Promise<void> {\n    if (this.app) {\n      this.app.update(opts);\n    } else {\n      await this.createApp(opts);\n    }\n  }\n\n  async mount(el?: string | Element): Promise<void> {\n    if (this.mounted || this.mounting) return;\n    if (!this.app) {\n      this.mounting = true;\n      let unloading;\n      const mountEl = el || (this.opts.props && this.opts.props.el);\n      if (this.uiLoading) unloading = this.uiLoading(mountEl, this.opts.loadingProps);\n      try {\n        await this.createApp();\n      } catch (error) {\n        if (this.uiError) {\n          this.destroyUIError = this.uiError(mountEl, this.opts.errorProps, this);\n          return;\n        }\n        throw error;\n      } finally {\n        this.mounting = false;\n        if (unloading) unloading();\n      }\n    }\n    this.app.mount(el);\n    this.mounted = true;\n  }\n\n  destroy(): void {\n    this.mounted = false;\n    this.mounting = false;\n    if (this.destroyUIError) {\n      this.destroyUIError();\n      this.destroyUIError = undefined;\n    }\n    if (this.app) this.app.destroy();\n  }\n\n  isMounted(): boolean {\n    return this.mounted;\n  }\n\n  isLoaded(): boolean {\n    return this.loaded;\n  }\n}\n\nfunction urlToValidator(path: string): AppInfo['isRouteMatch'] {\n  const regex = toDynamicPathValidatorRegex(path);\n  return function(_, p) {\n    return regex.test(p);\n  };\n}\n\nfunction toDynamicPathValidatorRegex(path: string) {\n  let lastIndex = 0,\n    inDynamic = false,\n    regexStr = '^';\n\n  if (path[0] !== '/') {\n    path = '/' + path;\n  }\n\n  for (let charIndex = 0; charIndex < path.length; charIndex++) {\n    const char = path[charIndex];\n    const startOfDynamic = !inDynamic && char === ':';\n    const endOfDynamic = inDynamic && char === '/';\n    if (startOfDynamic || endOfDynamic) {\n      appendToRegex(charIndex);\n    }\n  }\n\n  appendToRegex(path.length);\n  return new RegExp(regexStr, 'i');\n\n  function appendToRegex(index: number) {\n    const anyCharMaybeTrailingSlashRegex = '[^/]+/?';\n    const commonStringSubPath = escapeStrRegex(path.slice(lastIndex, index));\n\n    regexStr += inDynamic\n      ? anyCharMaybeTrailingSlashRegex\n      : commonStringSubPath;\n\n    if (index === path.length && !inDynamic) {\n      regexStr =\n        // use charAt instead as we could not use es6 method endsWith\n        regexStr.charAt(regexStr.length - 1) === '/'\n          ? `${regexStr}.*$`\n          : `${regexStr}([/#].*)?$`;\n    }\n\n    inDynamic = !inDynamic;\n    lastIndex = index;\n  }\n}\n\nfunction escapeStrRegex(str: string) {\n  // borrowed from https://github.com/sindresorhus/escape-string-regexp/blob/master/index.js\n  return str.replace(/[|\\\\{}()[\\]^$+*?.]/g, '\\\\$&');\n}\n","import AppInfo from './AppInfo';\nimport { App, AppEntry } from './types';\nimport { noop, isFunction, requestIdleCallback } from '../utils';\n\nconst appMap: Record<string, AppInfo> = Object.create(null);\n\nexport interface RegisterAppOptions<P = any, L = any, E = any> {\n  name: string;\n  load?: string | (() => Promise<AppEntry>);\n  props?: P;\n  mountWhen?: string | ((loc: Location, path: string) => boolean);\n  prefetch?: boolean;\n  loading?: boolean | ((el: string | Element, opts?: L, app?: AppInfo) => () => void);\n  error?: boolean | ((el: string | Element, opts?: E, app?: AppInfo) => () => void);\n  loadingProps?: L;\n  errorProps?: E;\n}\n\nexport function exportApp<T = any>(\n  fn: (options: T, isRoot: boolean) => Partial<App> | App['mount'] | [App['mount'], App['destroy']] | void\n) {\n  return function(options: T, isRoot: boolean): App | void {\n    let res = fn(options, isRoot);\n    if (isRoot) return;\n    const ret = { mount: noop, update: noop, destroy: noop };\n    if (isFunction(res)) {\n      res = { mount: res };\n    } else if (Array.isArray(res)) {\n      res = { mount: res[0], destroy: res[1] };\n    }\n    return Object.assign(ret, res);\n  };\n}\n\nexport function getApps(): AppInfo[] {\n  return Object.keys(appMap).map(x => appMap[x]);\n}\n\nexport function getApp(name: string): AppInfo {\n  return appMap[name];\n}\n\nexport function getAppChanges(path: string): {mounts: AppInfo[], destroys:  AppInfo[]} {\n  const ret: ReturnType<typeof getAppChanges> = { mounts: [], destroys:  [] };\n  getApps().forEach(app => {\n    if (app.isRouteMatch) {\n      const matched = app.isRouteMatch(location, path);\n      if (app.isMounted() && !matched) {\n        ret.destroys.push(app);\n      } else if (!app.isMounted() && matched) {\n        ret.mounts.push(app);\n      }\n    }\n  });\n  return ret;\n}\n\nexport function registerApp(opts: RegisterAppOptions): void {\n  const app = getApp(opts.name);\n  if (app) app.destroy();\n  appMap[opts.name] = new AppInfo(opts);\n  if (opts.prefetch) {\n    const app = appMap[opts.name];\n    requestIdleCallback(app.load.bind(app));\n  }\n}\n\nexport function unregisterApp(name: string): void {\n  destroyApp(name);\n  delete appMap[name];\n}\n\nexport async function mountApp(name: string, el?: string | Element): Promise<void> {\n  const app = getApp(name);\n  if (app) return app.mount(el);\n}\n\nexport function updateApp(name: string, opts: any): void {\n  const app = getApp(name);\n  if (app) app.update(opts);\n}\n\nexport function destroyApp(name: string): void {\n  const app = getApp(name);\n  if (app) return app.destroy();\n}\n","export const EVENT_ENABLE = 'enable';\nexport const EVENT_DISABLE = 'disable';\n","let onceSupported = false;\nlet prefix = 'grafeo:';\n\ntry{\n  new window.CustomEvent('T');\n}catch(e){\n  const CustomEvent = function<T>(event: string, params?: CustomEventInit<T>){\n    params = params || { bubbles: false, cancelable: false, detail: undefined };\n    const evt = document.createEvent('CustomEvent');\n    evt.initCustomEvent(event, params.bubbles as boolean, params.cancelable as boolean, params.detail);\n    return evt;\n  };\n  CustomEvent.prototype = window.Event.prototype;\n  self.CustomEvent = CustomEvent as any;\n}\n\ntry {\n  const options = Object.defineProperty({}, 'once', { get() { onceSupported = true; } });\n  self.addEventListener('test', null as any, options);\n} catch(err) {}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nconst listenerMap: Map<EventListener, EventListener> = new Map();\n\nfunction createListener(listener: EventListener): EventListener {\n  return function ({ detail }: any) { return listener(detail); };\n}\n\nexport function on(name: string, listener: EventListener, options?: boolean | AddEventListenerOptions): void {\n  const l = createListener(listener);\n  listenerMap.set(listener, l);\n  self.addEventListener(prefix + name, l, options);\n}\n\nexport function once(name: string, listener: EventListener): void {\n  const l = createListener(listener);\n  listenerMap.set(listener, l);\n  if (onceSupported) {\n    self.addEventListener(prefix + name, l, { once: true });\n  } else {\n    const tmp = (event: Event) => {\n      off(name, tmp);\n      l(event);\n    };\n    self.addEventListener(prefix + name, tmp);\n  }\n}\n\nexport function off(name: string, listener: EventListener): void {\n  const l = listenerMap.get(listener);\n  self.removeEventListener(prefix + name, l as EventListener);\n  listenerMap.delete(listener);\n}\n\nexport function emit<T = any>(name: string, detail?: T): void {\n  const evt = new CustomEvent(prefix + name, { detail, bubbles: false, cancelable: false });\n  self.dispatchEvent(evt);\n}\n\nexport function setEventPrefix(p: string): void {\n  prefix = p;\n}\n","import { EVENT_ENABLE, EVENT_DISABLE } from './constants';\nimport { emit } from './event';\n\nlet enabled = false;\n\nexport function isEnabled(): boolean {\n  return enabled;\n}\n\nexport function enable(): void {\n  if (enabled) return;\n  enabled = true;\n  emit(EVENT_ENABLE);\n}\n\nexport function disable(): void {\n  if (!enabled) return;\n  enabled = false;\n  emit(EVENT_DISABLE);\n}\n","import { getAppChanges } from './app';\nimport { storeError, throwErrors } from './utils';\nimport { isEnabled } from './enable';\nimport { EVENT_ENABLE } from './constants';\nimport { on } from './event';\n\nfunction createPopStateEvent(state: any) {\n  let evt;\n  try {\n    evt = new PopStateEvent('popstate', { state });\n  } catch (err) {\n    evt = document.createEvent('PopStateEvent');\n    (evt as any).initPopStateEvent('popstate', false, false, state);\n  }\n  return evt;\n}\n\nfunction patchedUpdateState(updateState: History['pushState'] | History['replaceState']) {\n  return function (this: History) {\n    const urlBefore = self.location.href;\n    // eslint-disable-next-line prefer-rest-params\n    const result = updateState.apply(this, arguments as any);\n    if (!isEnabled()) return result;\n    const urlAfter = self.location.href;\n\n    if (urlBefore !== urlAfter) {\n      self.dispatchEvent(createPopStateEvent(self.history.state));\n    }\n\n    return result;\n  };\n}\n\nlet reqAniId: number;\nfunction onReroute() {\n  if (!isEnabled()) return;\n  cancelAnimationFrame(reqAniId);\n  reqAniId = requestAnimationFrame(function() {\n    const path = location.href.replace(location.origin, '').replace(location.search, '').split('?')[0];\n    const apps = getAppChanges(path);\n    apps.mounts.forEach((app) => {\n      try {\n        app.mount();\n      } catch (error) {\n        storeError(error);\n      }\n    });\n    apps.destroys.forEach((app) => {\n      try {\n        app.destroy();\n      } catch (error) {\n        storeError(error);\n      }\n    });\n\n    throwErrors();\n  });\n}\n\nexport const originPushState = self.history.pushState;\nexport const originReplaceState = self.history.replaceState;\n\nself.history.pushState = patchedUpdateState(originPushState);\nself.history.replaceState = patchedUpdateState(originReplaceState);\nself.addEventListener('hashchange', onReroute);\nself.addEventListener('popstate', onReroute);\n\non(EVENT_ENABLE, onReroute);\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(275);\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"sourceRoot":""}